<!DOCTYPE html>

<html>
<head>
  <title>Presentation</title>
  <meta charset='utf-8'>
  <script src='http://html5slides.googlecode.com/svn/trunk/slides.js'></script>
</head>

<body style='display: none'>
<section class='slides layout-regular '>
  <article>
    <h1>
      Taking JavaScript to the next level
    </h1>

    <p>
      Christian Schwarz og Lars Brandt
      <br>
      19 August 2011
    </p>
  </article>
  <article>
    <h3>
      Agenda
    </h3>
    <ul>
      <li>
        Hvorfor gjøre noe annet enn vi gjør i dag?
      </li>
      <li>
        JavaScript fundamenter
      </li>
      <li>
        Nyttige hjelpere
      </li>
      <li>
        Testing
      </li>
      <li>
        Eksempel: Ajax
      </li>
      <li>
        Eksempel: Controller + View
      </li>
      <li>
        Lesson learned
      </li>
    </ul>
  </article>

  <article class='smaller'>
    <h3>
      Bring booking
    </h3>

    <p>
      <img style='width: 100%' src="http://i.imgur.com/OuVQ7.png"/>
    </p>
  </article>

  <article class='smaller'>
    <h3>
      Hvorfor gjøre noe annet enn vi gjør i dag?
    </h3>

    <p>
      PackageDetails anno 06.09.2010
    </p><br/>

    <p>
      <img style='width: 100%' src='http://i.imgur.com/v5gnu.png'>
    </p>
  </article>

  <article class='smaller'>
    <h3>
      Hvorfor gjøre noe annet enn vi gjør i dag?
    </h3>

    <p>
      PackageDetails anno 22.09.2010
    </p><br/>

    <p>
      <img style='width: 100%' src='http://i.imgur.com/JnBT1.png'>
    </p>
  </article>

  <article class='smaller'>
    <h3>
      Hvorfor gjøre noe annet enn vi gjør i dag?
    </h3>

    <p>
      PackageDetails anno 01.12.2010
    </p><br/>

    <p>
      <img style='width: 100%' src='http://i.imgur.com/rprLi.png'>
    </p>
  </article>

  <article>
    <h3>
      Hvorfor gjøre noe annet enn vi gjør i dag?
    </h3>
    <br/><br/>

    <p>
      <img src='http://i.imgur.com/Dy3Pc.png'>
    </p>
  </article>

  <article>
    <h3>
      Hvorfor gjøre noe annet enn vi gjør i dag?
    </h3>
    <ul>
      <li>
        Koden er vanskelig å gjenbruke
      </li>
      <li>
        Vanskelig å teste
      </li>
      <li>
        Ingen klar kodestandard
      </li>
      <li>
        Dårlig kvalitet
        <ul style="font-size: 22px">
          <li>Har mer bugs i JavaScript enn i Java selv om det bare utgjør 14% av kodebasen</li>
        </ul>
      </li>
      <li>
        Utfordrende og forbedre/refaktorere koden
      </li>
    </ul>
  </article>

  <article>
    <h3>
      Hva ønsket vi oss?
    </h3>
    <ul>
      <li>
        Ønsket å skrive tester slik vi gjorde med resten av koden
      </li>
      <li>
        Testene måtte kjøre som en del av bygget
      </li>
      <li>
        Forstå JavaScript og heve kvaliteten på koden
      </li>
    </ul>
  </article>

  <article>
    <h1>
      JavaScript fundamenter
    </h1>
  </article>

  <article>
    <h3>
      JavaScript fundamenter
    </h3>
    <ul>
      <li>
        Simple types er immutable
      </li>
      <ul style="font-size: 22px">
        <li>Numbers</li>
        <li>String</li>
        <li>Booleans</li>
        <li>null</li>
        <li>undefined</li>
      </ul>
      <li>
        Alt annet er objekter
      </li>
      <ul style="font-size: 22px">
        <li>Mutable</li>
        <li>Key / value pairs</li>
      </ul>
    </ul>
  </article>

  <article>
    <h3>
      Objekter
    </h3>
    <ul>
      <li>
        Samling av properties (key / value)
      </li>
      <li>
        Kan legge inn / modifisere properties fra hvor som helst
      </li>
      <li>
        Object literal: {}
      </li>
      <li>
        Link til en prototype
      </li>
      <ul style="font-size: 22px">
        <li>
          Property mangler -> prøver prototype’n
        </li>
        <li>
          {} har Object.prototype som prototype
        </li>
        <li>
          Hierarki
        </li>
      </ul>
    </ul>
  </article>
  <article>
    <h3>
      Funksjoner
    </h3>
    <ul>
      <li>
        Er objekter
      </li>
      <ul style="font-size: 22px">
        <li>
          Kan inneholde properties
        </li>
        <li>
          Kan tilordnes variable og sendes som argumenter
        </li>
      </ul>
      <li>
        Inneholder en kodeblokk
      </li>
      <ul style="font-size: 22px">
        <li>
          private variable, statements, expressions, ...
        </li>
      </ul>
      <li>
        Kan ha navn (for rekursivitet + debugging)
      </li>
      <li>
        Function literal
      </li>
    </ul>
    <pre>
  function() {}   //anonym funksjon

  function foo() {}  //er det samme som:

  var foo = function foo() {}
    </pre>
  </article>

  <article>
    <h3>
      Opprette objekter - Legge på properties
    </h3>
    <pre>
  var circle = {};
  circle.radius = 1;
  circle.area = function() { return this.radius * ... }

  var area = circle.area();

  //kan bytte ut public funksjon:
  circle.area = function() { alert("hei"); }
    </pre>
  </article>

  <article>
      <h3>
        Opprette objekter - Object literal
      </h3>
      <pre>
  var circle = {
     radius : 1,
     area : function() { return this.radius * ... }
  };
  var area = circle.area();

  //legg merke til “:” og “,”
      </pre>
  </article>

  <article>
    <h3>
      Opprette objekter - Closures
    </h3>
    <ul>
      <pre>
  function circle() {
    var radius = 1;
    return {
      area : function() { return radius * radius * 3.14 }
    }
  }

  //radius er “free variable” som lever videre
  //radius er privat / beskyttet

  alert(circle().area());
      </pre>
      <script type="text/javascript">
        function circle() {
          var radius = 1;
          return {
            area : function() { return radius * radius * 3.14 }
          }
        }
      </script>
    </pre>
    <button style="font-size: 28px;" onclick="alert(circle().area()); return false;">Prøv!</button>

    </ul>
  </article>
  <article>
    <h3>
      Opprette objekter - Construktor funksjon
    </h3>
    <pre>
  function Circle () {
    this.radius = 1;
    this.area = function() { return this.radius * ... };
  }
  var area = new Circle().area();

  //må huske “new” (navnekonvensjon)
    </pre>
  </article>
  
  <article>
    <h3>
      Tilganger / scope 
    </h3>
    <ul>
      <li>
        Variable har function scope
      </li>
      <li>
        Variable / funksjoner utenfor en funksjon har global scope
      </li>
      <ul style="font-size: 22px">
        <li>
          Navnekollisjoner
        </li>
      </ul>
      <li>
        Implicit global scope på udeklarerte variable
      </li>
    </ul>
  </article>
  
  <article>
    <h3>
      Selveksekvering med lokalt scope
    </h3>
    <pre>
  (function() {
     //snurr film
     //lokale variable havner ikke i global scope
     var name = “Ole”;
  }());
    </pre>
  </article>

  <article>
    <h3>
      Variable vs objekt properties
    </h3>
    <pre>
  function Person() {
      var name = "Per";
      this.name = "Ole";
      alert(name);
      alert(this.name);
  }

  new Person();  //hva alertes?
      <script type="text/javascript">
        function Person() {
            var name = "Per";
            this.name = "Ole";
            alert(name);
            alert(this.name);
        }
      </script>
    </pre>
    <button style="font-size: 28px;" onclick="new Person(); return false;">Prøv!</button>
  </article>

  <article>
    <h3>
      This
    </h3>
    <ul>
      <li>
        this har en dynamisk verdi
      </li>
      <li>
        Dot notation (“method invocation”):
      </li>
      <ul style="font-size: 22px">
        <li>
          circle.area() &nbsp;  //circle blir “this”
        </li>
      </ul>
      <li>
        Ikke dot notation (“function invocation”):
      </li>
      <ul style="font-size: 22px">
        <li>
          add(3, 4) &nbsp; // “this” blir global object (window)
        </li>
      </ul>
      <li>
        Eksplisitt sette this
      </li>
      <ul style="font-size: 22px">
        <li>
          someFunction.call(thisVerdi, arg1, arg2)
        </li>
        <li>
          someFunction.apply(thisVerdi, arguments)
        </li>
      </ul>
    </ul>
  </article>

  <article>
    <h1>
      Nyttige hjelpere
    </h1>
  </article>

  <article class='smaller'>
    <h3>
      Nyttige hjelpere - Bruk av namespace
    </h3>

    <ul>
      <li>
        Problem: globale variabler
      </li>
      <li>
        Løsning: bruk av namespacing
      </li>
    </ul>
    <section>
        <pre>
var utils = booking.namespace("utils");

utils.multiply = function(x, y) {
  return x * y;
};

var number = booking.utils.multiply(2.2, 2);
        </pre>
    </section>
    <p>Tips: la mappestrukturen i prosjekte speile namespace-hierarkiet</p>
  </article>

  <article class="smaller">
    <h3>
      Nyttige hjelpere - Prototypal Inheritance
    </h3>

    <ul>
      <li>
        Problem: Bruke JavaScript som java (new keyword)
      </li>
      <li>
        Løsning: Object.create(MotherObject);

        Legg merke til at det er et objekt som arver fra et objekt (ikke klasse)
      </li>
    </ul>
    <section>
         <pre>
var pirate = {
  numberOfWoodenLegs : 1,
  talk : function() { alert("Arrrrggg! I have " +
           parseInt(this.numberOfWoodenLegs, 10) + " wooden leg"); }
};

var polite_pirate = Object.create(pirate);
polite_pirate.talk = function() { alert("G'day mate. I have " +
           parseInt(this.numberOfWoodenLegs, 10) + " wooden leg"); }

pirate.talk();
polite_pirate.talk();
         </pre>
    </section>

  </article>

  <article class="smaller">
    <h3>
      Nyttige hjelpere - definere this for en callback
    </h3>

    <ul>
      <li>
        Problem: bruke “this” i en callback vi sender fra oss
      </li>
      <li>
        Løsning: someMethod.bind(this);
      </li>
    </ul>
    <section>
        <pre>
 function handleButtonClick(event) {
  this.controller.fetchPrice(this.weight.val());
 }

 function init(controller, pageObject) {
 ...
  pageObject.button.click(this.handleButtonClick.bind(this));
 }
        </pre>
    </section>
  </article>

  <article>
    <h1>
      Testing
    </h1>
  </article>

  <article>
    <h3>
        Rammeverk
    </h3>
    <ul>
      <li>
        Jasmine
      </li>
      <ul style="font-size: 22px">
        <li>
          BDD rammeverk
        </li>
        <li>
          Specifications and asserts
        </li>
        <li>
          Kjører i nettleser eller i maven
        </li>
        <ul style="font-size: 20px">
          <li>
            ctrl + r
          </li>
          <li>
            mvn test
          </li>
        </ul>
      </ul>
      <li>
        Sinon
      </li>
      <ul style="font-size: 22px">
        <li>
          Spy / stub / mock
        </li>
        <li>
          Jasmine integrasjon
        </li>
      </ul>
    </ul>
  </article>

  <article>
    <h3>
      Jasmine eksempel
    </h3>
    <br/>
    <pre>
  describe(“Circle”, function() {
    it(“should compute area”, function() {
      var circle = new Circle();
      circle.radius = 1;
      expect(circle.area()).toEqual(3.14);
    });
  });
    </pre>
  </article>

  <article>
    <h3>
      Sinon eksempel
    </h3>
    <br/>
    <pre>
  //Spy: Capture kall
  var fn = sinon.spy();
  // ..... 
  expect(fn).toHaveBeenCalled();

  //Stub: Returnerer verdier 
  var areaStub = sinon.stub().returns(3.14); 
  circle.area = areaStub;    //bytt ut funksjon

  //Mock: Verifiserer bruk 
  var mock = sinon.mock(circle).expects(“area”).once();
  // ...... 
  mock.verify(); 
    </pre>
  </article>

  <article>
    <h1>
      Eksempel: Ajax
    </h1>
  </article>

  <article>
    <h3>
      Definere objektet
    </h3>
    <br/>
    <pre>
it('should be namespaced', function() {
  var dao = Object.create(booking.helpers.priceDao);
  expect(dao).toBeDefined();
});
    </pre>

    <pre>
var helpers = booking.namespace("helpers");
helpers.priceDao = {};
    </pre>
  </article>

  <article>
    <h3>
      Inputvalidering
    </h3>
    <pre>
it('should reject empty weight', function () {
  expect(function() { dao.getPrice(); }).
      toThrow(new TypeError("Weight must be set"))
});
    </pre>

    <pre>
function getPrice(weight) {
  if (!weight) {
    throw new TypeError("Weight must be set");
  }
}

var helpers = booking.namespace("helpers");

helpers.priceDao = {
  getPrice : getPrice
};
    </pre>
  </article>

  <article>
    <h3>
      Spying
    </h3>
    <pre>
  it('should invoke ajax with weight as request parameter', function () {
    $.ajax = ajaxSpy = sinon.spy();

    var weight = 3;
    dao.getPrice(weight);

    expect(ajaxSpy).toHaveBeenCalled();

    var ajaxRequestParams = ajaxSpy.callArgument().data;
    expect(ajaxRequestParams).toEqual({ "weight": weight });
  });</pre>

    <pre>
function getPrice(weight) {
  ...
  var params = { "weight" : weight };
  $.ajax({
    data: params
  });
}</pre>
  </article>

  <article>
    <h3>
      Verifisere callbacks
    </h3>
    <pre>
  it('should invoke successfunction with data from remote service', function () {
    var successFunction = sinon.spy();
    dao.getPrice(3, successFunction);

    var jQuerySuccessFn = ajaxSpy.callArgument().success;
    var remoteData = { "price" : 9 };
    jQuerySuccessFn(remoteData); //simulate jQuery success

    expect(successFunction).toHaveBeenCalledWith(remoteData);
  });</pre>

    <pre>
function getPrice(weight, successFunction) {
  ...
  $.ajax({
    url: "price.jsp", data: params, type : "GET",
    dataType : 'json', success: successFunction
  });
}</pre>
  </article>


  <article>
    <h1>
      Eksempel: Controller + View
    </h1>
  </article>

  <article>
    <h1>
      Lesson learned
    </h1>
  </article>

  <article>
    <h3>
      Lesson learned
    </h3>
    <ul>
      <li>
        Lav terskel for å komme i gang, høy terskel for å skrive god kode
      </li>
      <li>
        Mange fete muligheter i JavaScript
      </li>
      <li>
        Krever at alle på teamet <strong>lærer</strong> seg JavaScript
      </li>
      <li>
      "Utils"-metoder må defineres først
      </li>
      <li>
        Mye lettere å vedlikeholde
      </li>
    </ul>
  </article>

  <article>
    <h3>
      Oppsummering
    </h3>
    <ul>
      <li>
        Hvorfor gjøre noe annet enn vi gjør i dag?
      </li>
      <li>
        JavaScript fundamenter
      </li>
      <li>
        Nyttige hjelpere
      </li>
      <li>
        Testing
      </li>
      <li>
        Eksempel: Ajax
      </li>
      <li>
        Eksempel: Controller + View
      </li>
      <li>
        Lesson learned
      </li>
    </ul>
  </article>

  <article>
    <h1>
      Takk for oss
    </h1>

    <div class='author'>
      Christian Schwarz og Lars Brandt
    </div>
  </article>


</section>
</body>
</html>
